<Window
    x:Class="glFTPd_Commander.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:glFTPd_Commander.Converters"
    xmlns:local="clr-namespace:glFTPd_Commander"
    xmlns:utils="clr-namespace:glFTPd_Commander.Utils"
    x:Name="RootWindow"
    Title="glFTPd Commander"
    WindowStartupLocation="CenterScreen"
    WindowState="Maximized">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
        <utils:RemoveCustomCommandProxy x:Key="RemoveCustomCommandProxy" Command="{Binding RemoveCustomCommandCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}}" />
        <converters:IconPathToImageSourceConverter x:Key="IconPathToImageSourceConverter" />
    </Window.Resources>

    <Grid x:Name="RootFadeContainer">
        <DockPanel Background="{DynamicResource BackgroundBrush}">
            <Menu DockPanel.Dock="Top">
                <MenuItem Header="Sites">
                    <MenuItem Click="SiteManagerMenuItem_Click" Header="Site Manager" />
                    <MenuItem x:Name="ConnectMenuItem" Header="Connect" />
                    <MenuItem
                        x:Name="DisconnectMenuItem"
                        Click="DisconnectMenuItem_Click"
                        Header="Disconnect" />
                </MenuItem>
                <MenuItem x:Name="UsersGroupsMenuItem" Header="Users &amp; Groups">
                    <MenuItem Click="AddUserMenuItem_Click" Header="Add User" />
                    <MenuItem Click="AddGroupMenuItem_Click" Header="Add Group" />
                </MenuItem>
                <MenuItem Header="Help">
                    <MenuItem Click="UserGuideMenuItem_Click" Header="User Guide" />
                    <MenuItem Click="AboutMenuItem_Click" Header="About" />
                </MenuItem>
            </Menu>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="350" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Grid Grid.Column="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel
                        Grid.Row="0"
                        Margin="42,5,0,5"
                        HorizontalAlignment="Left"
                        Orientation="Horizontal"
                        Visibility="{Binding IsConnected, Converter={StaticResource BoolToVis}}">
                        <TextBlock
                            Margin="0,0,12,0"
                            Cursor="Hand"
                            Foreground="DodgerBlue"
                            MouseLeftButtonUp="ExpandAllTextBlock_Click"
                            Text="Expand All"
                            TextDecorations="Underline" />
                        <TextBlock
                            Cursor="Hand"
                            Foreground="DodgerBlue"
                            MouseLeftButtonUp="CollapseAllTextBlock_Click"
                            Text="Collapse All"
                            TextDecorations="Underline" />
                    </StackPanel>
                    <TreeView
                        x:Name="FtpTreeView"
                        Grid.Row="1"
                        ItemsSource="{Binding RootItems}"
                        SelectedItemChanged="FtpTreeView_SelectedItemChanged">
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                                    <Image
                                        Width="16"
                                        Height="16"
                                        Margin="0,0,5,0"
                                        Source="{Binding Icon, Converter={StaticResource IconPathToImageSourceConverter}}" />
                                    <TextBlock VerticalAlignment="Center" Text="{Binding Name}" />
                                </StackPanel>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>
                        <TreeView.ItemContainerStyle>
                            <Style BasedOn="{StaticResource {x:Type TreeViewItem}}" TargetType="TreeViewItem">
                                <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                                <Setter Property="Padding" Value="0" />
                                <Setter Property="Margin" Value="1" />
                            </Style>
                        </TreeView.ItemContainerStyle>
                    </TreeView>
                </Grid>
                <TabControl
                    x:Name="RightTabControl"
                    Grid.Column="1"
                    MinWidth="700"
                    Margin="10,0,0,0"
                    HorizontalAlignment="Left">
                    <TabItem Header="User &amp; Group Info">
                        <ContentControl x:Name="UserGroupInfoContent" />
                    </TabItem>
                    <TabItem Header="Custom Commands">
                        <Grid Margin="10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <StackPanel
                                Grid.Row="0"
                                Grid.Column="0"
                                Margin="0,0,10,0">
                                <DockPanel Margin="0,0,0,5">
                                    <ComboBox
                                        x:Name="CommandInputComboBox"
                                        Width="700"
                                        Margin="0,0,5,0"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Center"
                                        IsEditable="True"
                                        IsReadOnly="False"
                                        KeyDown="CommandInputComboBox_KeyDown"
                                        ToolTip="Enter a SITE command (e.g., SITE USERS)"
                                        ToolTipService.InitialShowDelay="100" />
                                </DockPanel>
                                <TextBox
                                    x:Name="CommandOutputTextBox"
                                    Height="800"
                                    AcceptsReturn="True"
                                    Background="Black"
                                    FontFamily="Consolas"
                                    FontSize="13"
                                    Foreground="LightGreen"
                                    HorizontalScrollBarVisibility="Auto"
                                    IsReadOnly="True"
                                    TextWrapping="Wrap"
                                    VerticalScrollBarVisibility="Auto" />
                            </StackPanel>
                            <ItemsControl
                                Grid.Row="0"
                                Grid.Column="1"
                                VerticalAlignment="Top"
                                ItemsSource="{Binding CustomCommandSlots, RelativeSource={RelativeSource AncestorType=Window}}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformGrid Columns="2" Rows="10" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Button
                                            MinWidth="150"
                                            MinHeight="64"
                                            Margin="0,0,10,20"
                                            Padding="18,14"
                                            HorizontalContentAlignment="Center"
                                            VerticalContentAlignment="Center"
                                            Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                                            BorderBrush="{DynamicResource SystemControlHighlightAccentBrush}"
                                            BorderThickness="2"
                                            Command="{Binding DataContext.CustomCommandSlotClickCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}"
                                            Content="{Binding ButtonText}"
                                            FontSize="15"
                                            Foreground="White">
                                            <Button.ContextMenu>
                                                <ContextMenu>
                                                    <MenuItem
                                                        Command="{Binding Command, Source={StaticResource RemoveCustomCommandProxy}}"
                                                        CommandParameter="{Binding}"
                                                        Header="Remove"
                                                        Visibility="{Binding IsConfigured, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                                    <MenuItem
                                                        Header="Not Configured"
                                                        IsEnabled="False"
                                                        Visibility="{Binding IsConfigured, Converter={StaticResource InverseBooleanToVisibilityConverter}}" />
                                                </ContextMenu>
                                            </Button.ContextMenu>
                                        </Button>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Grid>
                    </TabItem>
                </TabControl>
            </Grid>
        </DockPanel>
    </Grid>

</Window>
